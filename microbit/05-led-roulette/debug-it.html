<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Depurando - Discovery</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Discover the world of microcontrollers through Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introdução</a></li><li class="chapter-item expanded "><a href="../01-background/index.html"><strong aria-hidden="true">1.</strong> Contexto</a></li><li class="chapter-item expanded "><a href="../02-requirements/index.html"><strong aria-hidden="true">2.</strong> Requisitos de hardware/conhecimento</a></li><li class="chapter-item expanded "><a href="../03-setup/index.html"><strong aria-hidden="true">3.</strong> Configurando o ambiente de desenvolvimento</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../03-setup/linux.html"><strong aria-hidden="true">3.1.</strong> Linux</a></li><li class="chapter-item expanded "><a href="../03-setup/windows.html"><strong aria-hidden="true">3.2.</strong> Windows</a></li><li class="chapter-item expanded "><a href="../03-setup/macos.html"><strong aria-hidden="true">3.3.</strong> macOS</a></li><li class="chapter-item expanded "><a href="../03-setup/verify.html"><strong aria-hidden="true">3.4.</strong> Verifique a instalação</a></li></ol></li><li class="chapter-item expanded "><a href="../04-meet-your-hardware/index.html"><strong aria-hidden="true">4.</strong> Conheça seu hardware</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../04-meet-your-hardware/microbit-v2.html"><strong aria-hidden="true">4.1.</strong> micro:bit v2</a></li><li class="chapter-item expanded "><a href="../04-meet-your-hardware/microbit-v1.html"><strong aria-hidden="true">4.2.</strong> micro:bit v1</a></li><li class="chapter-item expanded "><a href="../04-meet-your-hardware/terminology.html"><strong aria-hidden="true">4.3.</strong> Terminologia de Rust para Sistemas Embarcados</a></li></ol></li><li class="chapter-item expanded "><a href="../05-led-roulette/index.html"><strong aria-hidden="true">5.</strong> Roleta LED</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../05-led-roulette/build-it.html"><strong aria-hidden="true">5.1.</strong> Construindo</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/flash-it.html"><strong aria-hidden="true">5.2.</strong> Gravando</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/debug-it.html" class="active"><strong aria-hidden="true">5.3.</strong> Depurando</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/light-it-up.html"><strong aria-hidden="true">5.4.</strong> Acendendo</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/it-blinks.html"><strong aria-hidden="true">5.5.</strong> Está piscando</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/the-challenge.html"><strong aria-hidden="true">5.6.</strong> Desafio</a></li><li class="chapter-item expanded "><a href="../05-led-roulette/my-solution.html"><strong aria-hidden="true">5.7.</strong> Minha solução</a></li></ol></li><li class="chapter-item expanded "><a href="../06-serial-communication/index.html"><strong aria-hidden="true">6.</strong> Comunicação serial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../06-serial-communication/nix-tooling.html"><strong aria-hidden="true">6.1.</strong> Ferramentas para *nix</a></li><li class="chapter-item expanded "><a href="../06-serial-communication/windows-tooling.html"><strong aria-hidden="true">6.2.</strong> Ferramentas para Windows</a></li></ol></li><li class="chapter-item expanded "><a href="../07-uart/index.html"><strong aria-hidden="true">7.</strong> UART</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../07-uart/send-a-single-byte.html"><strong aria-hidden="true">7.1.</strong> Enviando um único byte</a></li><li class="chapter-item expanded "><a href="../07-uart/send-a-string.html"><strong aria-hidden="true">7.2.</strong> Enviando uma string</a></li><li class="chapter-item expanded "><a href="../07-uart/naive-approch-write.html"><strong aria-hidden="true">7.3.</strong> Abordagem ingênua e write!</a></li><li class="chapter-item expanded "><a href="../07-uart/receive-a-single-byte.html"><strong aria-hidden="true">7.4.</strong> Recebendo um único byte</a></li><li class="chapter-item expanded "><a href="../07-uart/echo-server.html"><strong aria-hidden="true">7.5.</strong> Servidor de eco</a></li><li class="chapter-item expanded "><a href="../07-uart/reverse-a-string.html"><strong aria-hidden="true">7.6.</strong> Invertendo uma string</a></li><li class="chapter-item expanded "><a href="../07-uart/my-solution.html"><strong aria-hidden="true">7.7.</strong> Minha solução</a></li></ol></li><li class="chapter-item expanded "><a href="../08-i2c/index.html"><strong aria-hidden="true">8.</strong> I2C</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../08-i2c/the-general-protocol.html"><strong aria-hidden="true">8.1.</strong> O protocolo geral</a></li><li class="chapter-item expanded "><a href="../08-i2c/lsm303agr.html"><strong aria-hidden="true">8.2.</strong> LSM303AGR</a></li><li class="chapter-item expanded "><a href="../08-i2c/read-a-single-register.html"><strong aria-hidden="true">8.3.</strong> Lendo um único registro</a></li><li class="chapter-item expanded "><a href="../08-i2c/using-a-driver.html"><strong aria-hidden="true">8.4.</strong> Usando um driver</a></li><li class="chapter-item expanded "><a href="../08-i2c/the-challenge.html"><strong aria-hidden="true">8.5.</strong> Desafio</a></li><li class="chapter-item expanded "><a href="../08-i2c/my-solution.html"><strong aria-hidden="true">8.6.</strong> Minha solução</a></li></ol></li><li class="chapter-item expanded "><a href="../09-led-compass/index.html"><strong aria-hidden="true">9.</strong> Bússola de LED</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../09-led-compass/calibration.html"><strong aria-hidden="true">9.1.</strong> Calibração</a></li><li class="chapter-item expanded "><a href="../09-led-compass/take-1.html"><strong aria-hidden="true">9.2.</strong> Abordagem 1</a></li><li class="chapter-item expanded "><a href="../09-led-compass/solution-1.html"><strong aria-hidden="true">9.3.</strong> Solução 1</a></li><li class="chapter-item expanded "><a href="../09-led-compass/take-2.html"><strong aria-hidden="true">9.4.</strong> Abordagem 2</a></li><li class="chapter-item expanded "><a href="../09-led-compass/solution-2.html"><strong aria-hidden="true">9.5.</strong> Solução 2</a></li><li class="chapter-item expanded "><a href="../09-led-compass/magnitude.html"><strong aria-hidden="true">9.6.</strong> Magnitude</a></li></ol></li><li class="chapter-item expanded "><a href="../10-punch-o-meter/index.html"><strong aria-hidden="true">10.</strong> Medidor de soco</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../10-punch-o-meter/gravity-is-up.html"><strong aria-hidden="true">10.1.</strong> A gravidade está para cima?</a></li><li class="chapter-item expanded "><a href="../10-punch-o-meter/the-challenge.html"><strong aria-hidden="true">10.2.</strong> Desafio</a></li><li class="chapter-item expanded "><a href="../10-punch-o-meter/my-solution.html"><strong aria-hidden="true">10.3.</strong> Minha solução</a></li></ol></li><li class="chapter-item expanded "><a href="../explore.html"><strong aria-hidden="true">11.</strong> O que resta para você explorar</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../appendix/1-general-troubleshooting/index.html">Solucionando problemas gerais</a></li><li class="chapter-item expanded affix "><a href="../appendix/2-how-to-use-gdb/index.html">Como usar o GDB</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Discovery</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-embedded/discovery/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- # Debug it -->
<h1 id="depurando"><a class="header" href="#depurando">Depurando</a></h1>
<!-- ## How does this even work? -->
<h2 id="como-isso-funciona"><a class="header" href="#como-isso-funciona">Como isso funciona?</a></h2>
<!-- Before we debug our little program let's take a moment to quickly understand what is actually
happening here. In the previous chapter we already discussed the purpose of the second chip
on the board as well as how it talks to our computer, but how can we actually use it? -->
<p>Antes de depurar nosso pequeno programa, vamos dedicar um momento para entender
rapidamente o que realmente está acontecendo aqui. No capítulo anterior, já
discutimos o propósito do segundo chip na placa e também como ele se comunica
com o nosso computador, mas como podemos realmente usá-lo?</p>
<!-- The little option `default.gdb.enabled = true` in `Embed.toml` made
`cargo-embed` open a so-called "GDB stub" after flashing, this is a server that
our GDB can connect to and send commands like "set a breakpoint at address X"
to. The server can then decide on its own how to handle this command. In the
case of the `cargo-embed` GDB stub it will forward the command to the debugging
probe on the board via USB which then does the job of actually talking to the
MCU for us. -->
<p>A pequena opção <code>default.gdb.enabled = true</code> no arquivo <code>Embed.toml</code> fez com que
o <code>cargo-embed</code> abrisse um chamado "GDB stub" após o flashing, que é um servidor
ao qual nosso GDB pode se conectar e enviar comandos como "definir um breakpoint
no endereço X". O servidor pode então decidir por conta própria como lidar com
esse comando. No caso do <code>cargo-embed</code> GDB stub, ele encaminhará o comando para
a sonda de depuração na placa via USB, que por sua vez faz o trabalho de
realmente se comunicar com a MCU para nós.</p>
<!-- ## Let's debug! -->
<h2 id="vamos-depurar"><a class="header" href="#vamos-depurar">Vamos depurar!</a></h2>
<!-- Since `cargo-embed` is blocking our current shell we can simply open a new one
and cd back into our project directory. Once we are there we first have to open
the binary in gdb like this: -->
<p>Como o <code>cargo-embed</code> está bloqueando nosso shell atual, podemos simplesmente
abrir um novo e voltar ao diretório do nosso projeto. Uma vez lá, primeiro temos
que abrir o binário no gdb assim:</p>
<pre><code class="language-shell"># Para micro:bit v2
$ gdb target/thumbv7em-none-eabihf/debug/led-roulette

# Para micro:bit v1
$ gdb target/thumbv6m-none-eabi/debug/led-roulette
</code></pre>
<!-- > **NOTE**: Depending on which GDB you installed you will have to use a
> different command to launch it, check out [chapter 3] if you forgot which one
> it was. -->
<blockquote>
<p><strong>NOTA</strong>: Dependendo de qual GDB você instalou, você terá que usar um comando
diferente para iniciá-lo. Verifique o Capítulo 3 se você esqueceu qual era.</p>
</blockquote>
<!-- [chapter 3]: ../03-setup/index.md#tools -->
<!-- > **NOTE**: If you are getting
> `target/thumbv7em-none-eabihf/debug/led-roulette: No such file or directory`
> error, try adding `../../` to the file path, for example:
>
> ```shell
> $ gdb ../../target/thumbv7em-none-eabihf/debug/led-roulette
> ```
>
> This is caused by each example project being in a `workspace` that contains
> the entire book, and workspaces have a single `target` directory. Check out
> [Workspaces chapter in Rust Book] for more. -->
<blockquote>
<p><strong>NOTA</strong>: Se você estiver recebendo o erro
<code>target/thumbv7em-none-eabihf/debug/led-roulette: No such file or directory</code>,
tente adicionar <code>../../</code> ao caminho do arquivo, por exemplo:</p>
<pre><code class="language-shell">$ gdb ../../target/thumbv7em-none-eabihf/debug/led-roulette
</code></pre>
<p>Isso ocorre porque cada projeto de exemplo está em um <code>workspace</code> que contém
todo o livro, e os workspaces possuem um único diretório de <code>destino</code>. Confira
o <a href="https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html#creating-a-workspace">capítulo de Workspaces no Livro de Rust</a> para mais informações.</p>
</blockquote>
<!-- [Workspaces chapter in Rust Book]: https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html#creating-a-workspace -->
<!-- > **NOTE**: If `cargo-embed` prints a lot of warnings here don't worry about it.
> As of now it does not fully implement the GDB protocol and thus might not
> recognize all the commands your GDB is sending to it, as long as it does not
> crash, you are fine. -->
<blockquote>
<p><strong>NOTA</strong>: Se o <code>cargo-embed</code> imprimir muitos avisos aqui, não se preocupe com
isso. Até o momento, ele não implementa totalmente o protocolo GDB e,
portanto, pode não reconhecer todos os comandos que seu GDB está enviando para
ele. Contanto que não ocorra uma falha, está tudo bem.</p>
</blockquote>
<!-- Next we will have to connect to the GDB stub. It runs on `localhost:1337` per
default so in order to connect to it run the following: -->
<p>Em seguida, teremos que nos conectar ao GDB stub. Ele é executado em
<code>localhost:1337</code> por padrão, portanto, para se conectar a ele, execute o
seguinte comando:</p>
<pre><code class="language-shell">(gdb) target remote :1337
Remote debugging using :1337
0x00000116 in nrf52833_pac::{{impl}}::fmt (self=0xd472e165, f=0x3c195ff7) at /home/nix/.cargo/registry/src/github.com-1ecc6299db9ec823/nrf52833-pac-0.9.0/src/lib.rs:157
157     #[derive(Copy, Clone, Debug)]
</code></pre>
<!-- Next what we want to do is get to the main function of our program. We will do
this by first setting a breakpoint there and the continuing program execution
until we hit the breakpoint: -->
<p>A seguir, o que queremos fazer é chegar à função principal do nosso programa.
Faremos isso primeiro configurando um breakpoint lá e continuando a execução do
programa até atingirmos ele:</p>
<pre><code>(gdb) break main
Breakpoint 1 at 0x104: file src/05-led-roulette/src/main.rs, line 9.
Note: automatically using hardware breakpoints for read-only addresses.
(gdb) continue
Continuing.

Breakpoint 1, led_roulette::__cortex_m_rt_main_trampoline () at src/05-led-roulette/src/main.rs:9
9       #[entry]
</code></pre>
<!-- Breakpoints can be used to stop the normal flow of a program. The `continue`
command will let the program run freely _until_ it reaches a breakpoint. In this
case, until it reaches the `main` function because there's a breakpoint there. -->
<p>Breakpoints podem ser usados para interromper o fluxo normal de um programa. O
comando <code>continue</code> permitirá que o programa seja executado livremente <em>até</em> que
ele atinja um breakpoint. Nesse caso, ele continuará a execução até chegar à
função <code>main</code>, pois há um breakpoint lá.</p>
<!-- Note that GDB output says "Breakpoint 1". Remember that our processor can only
use a limited amount of these breakpoints, so it's a good idea to pay attention
to these messages. If you happen to run out of breakpoints, you can list all the
current ones with `info break` and delete desired ones with
`delete <breakpoint-num>`. -->
<p>Observe que a saída do GDB diz "Breakpoint 1". Lembre-se de que nosso
processador só pode usar uma quantidade limitada desses breakpoints, então é uma
boa ideia prestar atenção nessas mensagens. Se você acabar ficando sem
breakpoints, pode listar todos os atuais com o comando <code>info break</code> e excluir os
desejados com <code>delete &lt;número-do-breakpoint&gt;</code>.</p>
<!-- For a nicer debugging experience, we'll be using GDB's Text User Interface
(TUI). To enter into that mode, on the GDB shell enter the following command: -->
<p>Para uma experiência de depuração mais agradável, estaremos usando a Interface
de Texto do Usuário (TUI) do GDB. Para entrar neste modo, no shell do GDB,
digite o seguinte comando:</p>
<pre><code>(gdb) layout src
</code></pre>
<!-- > **NOTE**: Apologies Windows users. The GDB shipped with the GNU ARM Embedded
> Toolchain doesn't support this TUI mode `:-(`. -->
<blockquote>
<p><strong>NOTA</strong>: Pedimos desculpas aos usuários do Windows. O GDB fornecido com a GNU
ARM Embedded Toolchain não suporta o modo TUI <code>:(</code>.</p>
</blockquote>
<p><img src="../assets/gdb-layout-src.png" alt="GDB session" title="GDB TUI" /></p>
<!-- GDB's break command does not only work for function names, it can also break at
certain line numbers. If we wanted to break in line 13 we can simply do: -->
<p>O comando "break" do GDB não funciona apenas para nomes de funções, ele também
pode interromper em determinados números de linha. Se quisermos interromper na
linha 13, podemos simplesmente fazer o seguinte:</p>
<pre><code>(gdb) break 13
Breakpoint 2 at 0x110: file src/05-led-roulette/src/main.rs, line 13.
(gdb) continue
Continuing.

Breakpoint 2, led_roulette::__cortex_m_rt_main () at src/05-led-roulette/src/main.rs:13
(gdb)
</code></pre>
<!-- At any point you can leave the TUI mode using the following command: -->
<p>A qualquer momento, você pode sair do modo TUI usando o seguinte comando:</p>
<pre><code>(gdb) tui disable
</code></pre>
<!-- We are now "on" the `_y = x` statement; that statement hasn't been executed yet.
This means that `x` is initialized but `_y` is not. Let's inspect those
stack/local variables using the `print` command: -->
<p>Agora estamos "na" instrução <code>_y = x</code>; essa instrução ainda não foi executada.
Isso significa que <code>x</code> está inicializado, mas <code>_y</code> não está. Vamos inspecionar
essas variáveis da pilha/locais usando o comando <code>print</code>:</p>
<pre><code>(gdb) print x
$1 = 42
(gdb) print &amp;x
$2 = (*mut i32) 0x20003fe8
(gdb)
</code></pre>
<!-- As expected, `x` contains the value `42`. The command `print &x` prints the
address of the variable `x`. The interesting bit here is that GDB output shows
the type of the reference: `i32*`, a pointer to an `i32` value. -->
<p>Conforme esperado, <code>x</code> contém o valor <code>42</code>. O comando <code>print &amp;x</code> imprime o
endereço da variável <code>x</code>. A parte interessante aqui é que a saída do GDB mostra
o tipo da referência: <code>i32*</code>, um ponteiro para um valor <code>i32</code>.</p>
<!-- If we want to continue the program execution line by line we can do that using
the `next` command so let's proceed to the `loop {}` statement: -->
<p>Se quisermos continuar a execução do programa linha por linha, podemos fazer
isso usando o comando <code>next</code>, então vamos prosseguir para a instrução <code>loop {}</code>:</p>
<pre><code>(gdb) next
16          loop {}
</code></pre>
<!-- And `_y` should now be initialized. -->
<p>E <code>_y</code> agora deve estar inicializado.</p>
<pre><code>(gdb) print _y
$5 = 42
</code></pre>
<!-- Instead of printing the local variables one by one, you can also use the
`info locals` command: -->
<p>Em vez de imprimir as variáveis locais uma por uma, você também pode usar o
comando <code>info locals</code>:</p>
<pre><code>(gdb) info locals
x = 42
_y = 42
(gdb)
</code></pre>
<!-- If we use `next` again on top of the `loop {}` statement, we'll get stuck
because the program will never pass that statement. Instead, we'll switch to the
disassemble view with the `layout asm` command and advance one instruction at a
time using `stepi`. You can always switch back into Rust source code view later
by issuing the `layout src` command again. -->
<p>Se usarmos <code>next</code> novamente em cima da instrução <code>loop {}</code>, ficaremos presos,
pois o programa nunca passará por essa instrução. Em vez disso, vamos mudar para
a visualização de desmontagem com o comando <code>layout asm</code> e avançar uma instrução
de cada vez usando <code>stepi</code>. Você sempre pode voltar para a visualização do
código-fonte em Rust posteriormente emitindo o comando <code>layout src</code> novamente.</p>
<!-- > **NOTE**: If you used the `next` or `continue` command by mistake and GDB got
> stuck, you can get unstuck by hitting `Ctrl+C`. -->
<blockquote>
<p><strong>NOTA</strong>: Se você usou o comando <code>next</code> ou <code>continue</code> por engano e o GDB ficou
preso, você pode desbloqueá-lo pressionando <code>Ctrl+C</code>.</p>
</blockquote>
<pre><code>(gdb) layout asm
</code></pre>
<p><img src="../assets/gdb-layout-asm.png" alt="GDB session" title="GDB disassemble" /></p>
<!-- If you are not using the TUI mode, you can use the `disassemble /m` command to
disassemble the program around the line you are currently at. -->
<p>Se você não estiver usando o modo TUI, pode usar o comando <code>disassemble /m</code> para
desmontar o programa em torno da linha em que você está atualmente.</p>
<pre><code>(gdb) disassemble /m
Dump of assembler code for function _ZN12led_roulette18__cortex_m_rt_main17h3e25e3afbec4e196E:
10      fn main() -&gt; ! {
   0x0000010a &lt;+0&gt;:     sub     sp, #8
   0x0000010c &lt;+2&gt;:     movs    r0, #42 ; 0x2a

11          let _y;
12          let x = 42;
   0x0000010e &lt;+4&gt;:     str     r0, [sp, #0]

13          _y = x;
   0x00000110 &lt;+6&gt;:     str     r0, [sp, #4]

14
15          // infinite loop; just so we don't leave this stack frame
16          loop {}
=&gt; 0x00000112 &lt;+8&gt;:     b.n     0x114 &lt;_ZN12led_roulette18__cortex_m_rt_main17h3e25e3afbec4e196E+10&gt;
   0x00000114 &lt;+10&gt;:    b.n     0x114 &lt;_ZN12led_roulette18__cortex_m_rt_main17h3e25e3afbec4e196E+10&gt;

End of assembler dump.
</code></pre>
<!-- See the fat arrow `=>` on the left side? It shows the instruction the processor
will execute next. -->
<p>Vê a seta gorda <code>=&gt;</code> no lado esquerdo? Ela mostra a instrução que o processador
executará em seguida.</p>
<!-- If not inside the TUI mode on each `stepi` command GDB will print the statement
and the line number of the instruction the processor will execute next. -->
<p>Se você não estiver no modo TUI, em cada comando <code>stepi</code>, o GDB imprimirá a
declaração e o número da linha da instrução que o processador executará em
seguida.</p>
<pre><code>(gdb) stepi
16          loop {}
(gdb) stepi
16          loop {}
</code></pre>
<!-- One last trick before we move to something more interesting. Enter the following
commands into GDB: -->
<p>Um último truque antes de passarmos para algo mais interessante. Digite os
seguintes comandos no GDB:</p>
<pre><code>(gdb) monitor reset
(gdb) c
Continuing.

Breakpoint 1, led_roulette::__cortex_m_rt_main_trampoline () at src/05-led-roulette/src/main.rs:9
9       #[entry]
(gdb)
</code></pre>
<!-- We are now back at the beginning of `main`! -->
<p>Agora estamos de volta ao início de <code>main</code>!</p>
<!-- `monitor reset` will reset the microcontroller and stop it right at the program
entry point. The following `continue` command will let the program run freely
until it reaches the `main` function that has a breakpoint on it. -->
<p><code>monitor reset</code> irá reiniciar o microcontrolador e pará-lo exatamente no ponto
de entrada do programa. O comando <code>continue</code> seguinte permitirá que o programa
seja executado livremente até chegar à função <code>main</code>, que possui um breakpoint.</p>
<!-- This combo is handy when you, by mistake, skipped over a part of the program
that you were interested in inspecting. You can easily roll back the state of
your program back to its very beginning. -->
<p>Essa combinação é útil quando você, por engano, pulou uma parte do programa que
estava interessado em inspecionar. Você pode facilmente reverter o estado do seu
programa de volta ao seu início.</p>
<!-- > **The fine print**: This `reset` command doesn't clear or touch RAM. That
> memory will retain its values from the previous run. That shouldn't be a
> problem though, unless your program behavior depends on the value of
> _uninitialized_ variables but that's the definition of Undefined Behavior
> (UB). -->
<blockquote>
<p><strong>Detalhe</strong>: O comando <code>reset</code> não limpa ou altera a RAM. Essa memória reterá
seus valores da execução anterior. Isso não deve ser um problema, a menos que
o comportamento do seu programa dependa do valor de variáveis <em>não
inicializadas</em>, mas essa é a definição de Comportamento Indefinido (Undefined
Behavior - UB).</p>
</blockquote>
<!-- We are done with this debug session. You can end it with the `quit` command. -->
<p>Concluímos esta sessão de depuração. Você pode encerrá-la com o comando <code>quit</code>.</p>
<pre><code>(gdb) quit
A debugging session is active.

        Inferior 1 [Remote target] will be detached.

Quit anyway? (y or n) y
Detaching from program: $PWD/target/thumbv7em-none-eabihf/debug/led-roulette, Remote target
Ending remote debugging.
[Inferior 1 (Remote target) detached]
</code></pre>
<!-- > **NOTE**: If the default GDB CLI is not to your liking check out
> [gdb-dashboard]. It uses Python to turn the default GDB CLI into a dashboard
> that shows registers, the source view, the assembly view and other things. -->
<blockquote>
<p><strong>NOTA</strong>: Se a CLI padrão do GDB não for do seu agrado, confira o
<a href="https://github.com/cyrus-and/gdb-dashboard#gdb-dashboard">gdb-dashboard</a>. Ele usa Python para transformar a interface padrão do GDB em
um painel que mostra os registros, a visualização do código-fonte, a
visualização em assembly e outras coisas.</p>
</blockquote>
<!-- If you want to learn more about what GDB can do, check out the section
[How to use GDB](../appendix/2-how-to-use-gdb/). -->
<p>Se você deseja aprender mais sobre o que o GDB pode fazer, confira a seção
<a href="../appendix/2-how-to-use-gdb/">Como usar o GDB</a>.</p>
<!-- What's next? The high level API I promised. -->
<p>O que vem a seguir? A API de alto nível que eu prometi.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../05-led-roulette/flash-it.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../05-led-roulette/light-it-up.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../05-led-roulette/flash-it.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../05-led-roulette/light-it-up.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
